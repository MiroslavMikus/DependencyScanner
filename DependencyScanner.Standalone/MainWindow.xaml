<Controls:MetroWindow x:Class="DependencyScanner.Standalone.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:converter="clr-namespace:DependencyScanner.Standalone.Converters"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DependencyScanner.Standalone"
        mc:Ignorable="d"
        Title="Dependency scanner" Height="450" Width="800"
        x:Name="TheMainWindow">
    <Controls:MetroWindow.Resources>
        <converter:NullToVisibilityConverter x:Key="HideIfNull" Positive="Collapsed" Negative="Visible"/>
    </Controls:MetroWindow.Resources>
    <Grid>
        <TabControl>
            <TabItem Header="Browse" DataContext="{Binding BrowseVM}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Row="0">
                        <Button Margin="5,5,0,5" Content="Scan" HorizontalAlignment="Left"
                            Command="{Binding ScanCommand}"
                            Visibility="{Binding WorkingDirectory, Converter={StaticResource HideIfNull}}" Grid.Row="1"
                            />
                        <Button Content="Pick working directory" HorizontalAlignment="Left" Margin="5" Command="{Binding PickWorkingDirectoryCommand}"/>
                        <TextBlock Text="{Binding WorkingDirectory.FullName, StringFormat='Your folder: {0}'}" VerticalAlignment="Center" Margin="5"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Row="1">
                        <DataGrid Margin="5" x:Name="AllSolutions" SelectionMode="Single" ItemsSource="{Binding ScanResult}" AutoGenerateColumns="False" >
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="#">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                                                <Button Margin="2" Content="Open" ToolTip="Open solution" 
                                                        Command="{Binding ElementName=TheMainWindow, Path=DataContext.OpenSolutionCommand}"
                                                        CommandParameter="{Binding Info.FullName}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn IsReadOnly="True" Header="Solution" Binding="{Binding Info}" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <DataGrid Margin="5" x:Name="Projects" SelectionMode="Single" ItemsSource="{Binding ElementName=AllSolutions, Path=SelectedItem.Projects}" IsReadOnly="True" AutoGenerateColumns="False" CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Project" Binding="{Binding ProjectInfo.Name}" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <DataGrid Margin="5" SelectionMode="Single" ItemsSource="{Binding ElementName=Projects, Path=SelectedItem.References}" IsReadOnly="True" AutoGenerateColumns="False" CanUserAddRows="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Id" Binding="{Binding Id}" />
                                <DataGridTextColumn Header="Version" Binding="{Binding Version}" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Grid>
            </TabItem>
            <TabItem Header="Consolidate solutions" DataContext="{Binding ConsolidateSolutionsVM}" x:Name="ConsolidateSolutions">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel HorizontalAlignment="Left" Orientation="Horizontal">
                        <Button Content="Select all" Margin="5" Command="{Binding SelectAllCommand}"/>
                        <Button Content="Deselect all" Margin="5" Command="{Binding DeSelectAllCommand}"/>
                        <Button Content="Quick compare" Command="{Binding ScanCommand}" Margin="5" HorizontalAlignment="Left"/>
                    </StackPanel>
                    <ScrollViewer Margin="5" Grid.Column="0" Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                        <StackPanel>
                            <Label Content="Select solutions to compare:"/>
                            <DataGrid ItemsSource="{Binding ScanResult}" AutoGenerateColumns="False"  CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn IsReadOnly="False" Header="#" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <DataGridTextColumn IsReadOnly="True" Header="Solution" Binding="{Binding Result.Info.Name}" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </ScrollViewer>
                    <ScrollViewer Margin="5" Grid.Column="1" Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                        <StackPanel>
                            <Label Content="Consolidate nugets: "/>
                            <DataGrid x:Name="References" SelectionMode="Single" ItemsSource="{Binding ResultReferences}" AutoGenerateColumns="False" CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn IsReadOnly="True" Header="Id" Binding="{Binding Id}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </ScrollViewer>
                    <ScrollViewer Margin="5" Grid.Column="2" Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                        <StackPanel>
                            <Label Content="Occurs in solutions: "/>
                            <DataGrid ItemsSource="{Binding ElementName=References, Path=SelectedItem.References}" AutoGenerateColumns="False"  CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="#">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                                                    <Button Margin="2" Content="Open" ToolTip="Open solution" 
                                                        Command="{Binding ElementName=TheMainWindow, Path=DataContext.OpenSolutionCommand}"
                                                        CommandParameter="{Binding Key.Info.FullName}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Solution" IsReadOnly="True">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Label Content="{Binding Key}" ToolTip="{Binding Key.Info.FullName}"></Label>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn IsReadOnly="True" Header="Version" Binding="{Binding Value}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Controls:MetroWindow>
